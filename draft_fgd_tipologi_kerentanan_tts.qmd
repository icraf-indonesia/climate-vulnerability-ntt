---
title: "[DRAFT] Tipologi Kerentanan Iklim pada Penghidupan Berbasis Pertanian: Kabupaten Timor Tengah Selatan"
format: 
  html:
    toc: true
    number-sections: true
    embed-resources: false
editor: visual
execute:
  echo: false
project:
  type: website
  output-dir: docs
editor_options: 
  chunk_output_type: inline
comments:
  utterances:
    repo: icraf-indonesia/climate-vulnerability-ntt
---

```{r session info}
# sessionInfo()
# Sys.getenv()
# .libPaths()

# If the sessioninfo package is available, 
# it provides output that is easier to read,
# and can write its results to a file
sessioninfo:::session_info(to_file = "quarto-session-info-output.txt")

```

```{r load library}
#| warning: false
#| message: false
library(tibble)
library(targets)
library(tarchetypes)
library(ggplot2)
library(leaflet)
library(gt)
library(sf)
library(dplyr)
library(plotly)
library(readr)
```

# Pendahuluan

::: panel-tabset
## Abstrak

Penghidupan berbasis pertanian kini makin rentan terhadap perubahan iklim, tetapi informasi mengenai potensi resiko dan kebutuhan adaptasi mereka masih sangat terbatas. Draft dokumen ini disusun untuk mengisi kekosongan ini dengan mengevaluasi berbagai jenis kerentanan yang mempengaruhi mata pencaharian berbasis pertanian di tingkat provinsi. Kami melakukan penilaian kerentanan untuk mengidentifikasi risiko serta penyebabnya, dan potensi adaptasi, dengan fokus pada peningkatan taraf hidup, keberlanjutan produksi komoditas-komoditas kunci, dan pengelolaan lahan secara menyeluruh.

Mengingat tingginya keanekaragaman lanskap di Kabupaten Timor Tengah Selatan, kami memfokuskan perhatian pada kecamatan-kecamatan dengan fitur biofisik dan sosial-ekonomi yang mirip. Ini membantu kami mempermudah tugas dalam mengidentifikasi risiko yang identik antar kecamatan. Kami mendefinisikan area-area homogen ini, atau 'tipologi,' dengan menggunakan pengelompokan K-means. Pengelompokan ini didasarkan pada komposit dari indikator biofisik dan sosial-ekonomi. Untuk mempermudah proses pengelompokan, kami menggunakan analisis PCA untuk menyederhanakan dimensi data.

## Tujuan

-   Analisis ini bertujuan untuk mengidentifikasi 'tipologi' kecamatan-kecamatan, yang memiliki karakter sosial-ekonomi dan lingkungan yang mirip di Kabupaten Timor Tengah Selatan, dengan menggunakan pengelompokan K-means pada data yang disederhanakan oleh PCA.

-   Tipologi tersebut kemudian digunakan untuk mendeskripsikan konteks kerentanan penghidupan berbasis pertanian akibat perubahan iklim di Kabupaten Timor Tengah Selatan dan potensi intervensi untuk meningkatkan ketahanan terhadap perubahan iklim.
:::

# Metodologi

::: panel-tabset

## Daftar Variabel

**Unit analisis terkecil**: Kecamatan

```{r}
#| warning: false
#| message: false
read_csv("data/List_variable_bahasa.csv") |> 
  gt(rowname_col = "No")
```

## Skema Teknis Pembuatan Tipologi

![](data/workflow.svg){height="1200" width="800" fig-align="center"}

## Intisari Hasil PCA

```{r PCA Summary}
#| warning: false
#| message: false
pca_summary <- tar_read(pca_result) |> 
  summary() 

# Extracting the relevant parts of the summary
std_dev <- pca_summary$importance["Standard deviation", ]
prop_variance <- pca_summary$importance["Proportion of Variance", ]
cumul_prop <- pca_summary$importance["Cumulative Proportion", ]

# Creating a data frame
pca_df <- tibble(
  PC = names(std_dev),
  StandardDeviation = std_dev,
  ProportionOfVariance = prop_variance,
  CumulativeProportion = cumul_prop
) |> head(n = 12)

pca_df |> 
  gt() |> 
  tab_header(
    title = "Intisari Analisis Komponen Utama (PCA)",
    subtitle = "Tingkat Kepentingan Komponen"
  ) |> 
  cols_label(
    PC = "Komponen",
    StandardDeviation = "Standar Deviasi",
    ProportionOfVariance = "Proporsi Variansi",
    CumulativeProportion = "Proporsi Kumulatif"
  ) |> 
  fmt_number(
    columns = vars(StandardDeviation, ProportionOfVariance, CumulativeProportion),
    decimals = 4
  ) |> 
  tab_options(
    heading.background.color = "lightblue",
    column_labels.font.size = "small"
  )
```

------------------------------------------------------------------------

### Interpretasi Komponen Utama (PCs)

**PC1: Predominan Bahaya Longsor dan indikator iklim terkait hujan** (`r pca_df[1,3]*100`%) ![](output/Loadings%20for%20PC1.png)

**PC2: Predominan indikator iklim terkait temperatur dan elevasi** (`r pca_df[2,3]*100`%) ![](output/Loadings%20for%20PC2.png)

**PC3: Predominan indikator kesejahtraan dan fasilitas publik** (`r pca_df[3,3]*100`%) ![](output/Loadings%20for%20PC3.png)

**PC4: Predominan infrastruktur peringatan bencana dan indikator iklim terkait hujan**(`r pca_df[4,3]*100`%) ![](output/Loadings%20for%20PC4.png)

**PC5: Predominan komposisi tutupan lahan** (`r pca_df[5,3]*100`%) ![](output/Loadings%20for%20PC5.png)

## Hasil Pengelompokan K-means

### Diagram pencar 3D tipologi kecamatan-kecamatan di Kabupaten Timor Tengah Selatan

-   Sumbu x,y dan z dari diagram pencar merupakan tiga komponen utama teratas dari hasil PCA.
    -   **PC1: Predominan Bahaya Longsor dan indikator iklim terkait hujan**
    -   **PC2: Predominan indikator iklim terkait temperatur dan elevasi**
    -   **PC3: Predominan indikator kesejahtraan dan fasilitas publik**
-   Tiap-titiknya mewakili sebuah kecamatan di Kabupaten Timor Tengah Selatan
-   Titik yang berwarna sama berarti tergolong dalam tipologi yang sama.

```{r K-means cluster}
#| warning: false
#| message: false
tar_load(scaled_df_complete)
tar_load(input_kmean)
tar_load(kmeans_result)

# Extract names for labeling
names_kab_kec <- scaled_df_complete |> 
    select(c(nmkab, nmkec))
  
  # Prepare data for plotting
plot_data <- data.frame(input_kmean, cluster = as.factor(kmeans_result$cluster))|> 
  bind_cols(names_kab_kec) |> 
  dplyr::filter(nmkab %in% "TIMOR TENGAH SELATAN")
  
  
  # Create the 3D scatter plot
plot_3d <- plot_ly(
    data = plot_data,
    x = ~PC1,
    y = ~PC2,
    z = ~PC3,
    color = ~cluster,
    type = "scatter3d",
    text = ~paste("Kab./Kota:", nmkab, "<br>Kecamatan:", nmkec),
    mode = "markers")

plot_3d
```

### Cluster Validation

::: {layout-ncol="2"}
```{r wss plot}
#| warning: false
#| message: false
tar_load(elbow_plot)

elbow_plot
```

Titik 'siku' dari sebuah elbow plot adalah titik di mana menambahkan penambahan jumlah kluster tidak banyak memberikan tambahan informasi baru.

```{r shillouete}
#| warning: false
#| message: false

tar_load(silhouette_plot)

silhouette_plot
```

Plot siluet yang mendekati +1 menunjukkan pengelompokan yang baik, sementara nilai yang mendekati 0 atau nilai negatif menunjukkan pengelompokan yang tumpang tindih atau tidak baik.
:::
:::

# Hasil & Interpretasi Sementara (Draft)

**Tipologi Kerentanan Terhadap Perubahan Iklim pada Penghidupan Berbasis Pertanian di Kabupaten Timor Tengah Selatan**

::: panel-tabset
## Peta Tipologi

```{r Map}
#| warning: false
#| message: false

source("R/functions.R")

# cluster_ntt <- st_read("output/tipologi_ntt_.shp") |> 
#   dplyr::filter(nmkab %in% "TIMOR TENGAH SELATAN")

# cluster_ntt |> write_sf("output/tipologi_tts.shp")

lookup_cluster <- read_csv("data/cluster_names_tts_3.csv")


tp_map <- create_leaflet_map(clusters_kec = "output/tipologi_tts.shp", cluster_lookup = "data/cluster_names_tts_3.csv")

tp_map
```

<!-- ## Komposisi Luas Wilayah -->

```{r komposisi kecamatan}
#| warning: false
#| message: false

# intisari_desk_kec <- readr::read_csv("data/interpretasi_tipologi_bone.csv") |> 
#   dplyr::mutate(`Kepadatan RT` = `Luas (Ha)`/`Rumah Tangga`) |> 
#   mutate(color_pal = c( "#377EB8","#E41A1C","#FF7F00" ,  "#4DAF4A", "black" ))
# 
# fig_luas <- intisari_desk_kec |> 
#   filter(Nama != "Total") |> 
#   plot_ly( labels = ~Nama, values = ~`Luas (Ha)`,
#                marker = list(colors = ~color_pal))|> 
#   add_pie(hole = 0.6) |> 
#   layout(title = "Komposisi Luas Wilayah (Ha)",
#          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
#          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))  
# 
# # Show the plot
# fig_luas
```

## Komposisi Demografi

```{r donat RT}
# Create the plot for Jumlah RT

tar_load(clusters_kec_tbl)
tar_load(df_raw)
tar_load(cluster_lookup)

Total_KK <- clusters_kec_tbl |> ungroup() |> 
  dplyr::filter(nmkab %in% "TIMOR TENGAH SELATAN") |> 
  select("cluster") |>
  bind_cols(df_raw) |>
  left_join(cluster_lookup, by = "cluster") |>
  select(name, total_kk, luas_ha) |>
  group_by(name) |>
  summarise(total_kk = sum(total_kk),
            luas = sum(luas_ha),
            kepadatan = total_kk/luas) |> 
  rename(Nama = name, `Rumah Tangga` = total_kk) |> 
  mutate(color_pal = c("#E41A1C", "#2166AC", "#4DAF4A", "yellow"))


fig_RT <- Total_KK |>
  plot_ly(
    labels = ~ Nama,
    values = ~ `Rumah Tangga`,
     marker = list(colors = ~color_pal)
  ) |>
  add_pie(hole = 0.6) |>
  layout(
    title = "Jumlah Rumah Tangga",
    xaxis = list(
      showgrid = FALSE,
      zeroline = FALSE,
      showticklabels = FALSE
    ),
    yaxis = list(
      showgrid = FALSE,
      zeroline = FALSE,
      showticklabels = FALSE
    )
  )  

# Show the plot
fig_RT
```


## Kepadatan Rumah tangga
```{r kepadatan RT}
ggplot(Total_KK, aes(x = Nama, y = kepadatan*100, fill = color_pal)) +
  geom_bar(stat = "identity") +
  scale_fill_identity() +
  theme_minimal() +
  labs(y = "Kepadatan Rumah Tangga/Km2")
```

## **Tipologi 1**

::: callout-tip
Tipologi padat penduduk, dengan ekonomi yang ditopang oleh sektor non-pertanian dan tutupan lahan alami yang sedikit. Penyediaan air dan pangan bergantung dari daerah sekitarnya.  Tipologi ini memiliki infrastruktur dan fasilitas publik yang baik, serta angka penderita gizi buruk dan kemiskinan yang rendah.
:::


### Karakteristik berdasarkan analisis SWOT

::: {layout-ncol="2"}
#### Kekuatan (*Strengths*)

Faktor-faktor internal yang membantu pencapaian tujuan:

-   Kepadatan rumah tangga yang tinggi menandakan aktivitas ekonomi niaga dan jasa dapat memberikan stabilitas ekonomi karena tidak terlalu tergantung pada satu sektor.

- Angka penderita gizi buruk yang rendah dan tingkat kemiskinan paling rendah mencerminkan tingkat kesejahteraan yang lebih baik.

- Rasio elektrifikasi tinggi menunjukkan akses yang baik ke infrastruktur dasar dan mendukung aktivitas ekonomi.

- Fasilitas kesehatan, pasar, sekolah tinggi, dan tersedia rumah sakit menandakan infrastruktur yang baik.
Aksesibilitas tinggi ke transportasi udara dan pelabuhan mendukung distribusi hasil niaga dan jasa


    ------------------------------------------------------------------------

#### Kelemahan (*Weaknesses*)

Faktor-faktor internal yang menghalangi pencapaian tujuan:

- Tidak punya lahan untuk memproduksi pangan secara mandiri, karena area yang dapat digunakan untuk pertanian sangat sedikit.

- Rendahnya persentase area lindung dan tutupan hijau, menunjukkan ketergantungan atas penyediaan jasa lingkungan air bersih dari tipologi sekitarnya.

- Jasa lingkungan terutama penyediaan air bergantung dari daerah hulu.


    ------------------------------------------------------------------------

#### Peluang (*Opportunities*)

Faktor-faktor eksternal yang membantu pencapaian tujuan:

-   Pembangunan infrastruktur niaga: Memiliki akses yang baik, terdapat peluang untuk meningkatkan infrastruktur niaga, pengembangan pasar yang mendukung pertumbuhan bisnis.

- Diversifikasi usaha: aksesibilitas tinggi dan infrastruktur yang baik memberikan peluang untuk diversifikasi usaha di sektor niaga dan jasa, seperti pengembangan pusat perbelanjaan, hotel, atau pusat hiburan.


    ------------------------------------------------------------------------

#### Ancaman (*Threats*)

Faktor-faktor eksternal yang menghalangi pencapaian tujuan:

-   Bergantung pada suplai pangan dari luar tipologi, sehingga tidak dapat menjaga stok kebutuhan pangan penduduk sekaligus kestabilan harga. Hal ini menjadi ancaman serius karena tipologi 1 memiliki jumlah penduduk paling tinggi dibandingkan dengan tipologi lainnya.

- Bencana alam dan gangguan akibat cuaca ekstrim di tipologi sekitarnya berpotensi mengganggu kelangsungan operasional sektor niaga dan jasa.

- Kesenjangan ekonomi lebar: Masih terdapat penduduk dengan kesejahteraan ekonomi rendah saat sebagian penduduk memiliki kesejahteraan yang baik. Ketidak merataan ekonomi dapat menjadi hambatan bagi perkembangan ekonomi dan usaha.

:::


## **Tipologi 2**

::: callout-tip
Tipologi ini memiliki curah hujan tinggi dan tutupan hutan yang baik dan menawarkan jasa lingkungan potensi pariwisata alam. Namun, terdapat risiko erosi, dan longsor yang tinggi, disertai dengan infrastruktur publik dan aksesibilitas jalan yang terbatas serta kecenderungan gizi buruk yang tinggi.
:::

### Karakteristik berdasarkan analisis SWOT

::: {layout-ncol="2"}
#### Kekuatan (*Strengths*)

Faktor-faktor internal yang membantu pencapaian tujuan:

-   Jasa lingkungan tinggi: Memiliki curah hujan yang paling tinggi diantara tipologi lainnya, dengan suhu paling rendah diantara cluster lain. Tingkat ketersediaan keanekaragaman hayati cukup besar karena berdekatan dengan tutupan hutan.

-  Suhu sejuk: suhu rata-rata yang lebih rendah (21.74°C), nyaman untuk ditinggali dan lebih tahan terhadap prediksi peningkatan suhu + 1.41 °C di 2050.
Kondisi elevasi tinggi dan savana memberikan peluang untuk energi terbarukan dari angin (PLTB).

-  Potensi Pariwisata Alam: Tingginya persentase area hutan dan savana (68.02%) memberikan potensi untuk pengembangan pariwisata alam yang dapat mendukung sektor ekowisata jasa lingkungan.


    ------------------------------------------------------------------------

#### Kelemahan (*Weaknesses*)

Faktor-faktor internal yang menghalangi pencapaian tujuan:

- Risiko Perubahan Iklim: curah hujan yang tinggi (2084.31 mm), dipadu dengan elevasi dan kelerengan tinggi meningkatkan risiko erosi dan tanah longsor.

- Keterbatasan fasilitas niaga dan jasa: Jumlah minimarket, pasar desa, dan pusat niaga lainnya yang rendah dapat menjadi kendala dalam mendukung distribusi hasil bumi, serta aktivitas niaga dan jasa. Aksesibiliitas jalan raya terbatas.


    ------------------------------------------------------------------------

#### Peluang (*Opportunities*)

Faktor-faktor eksternal yang membantu pencapaian tujuan:

- Pengembangan pertanian berkelanjutan: Kondisi tanah yang paling cukup air, ada peluang untuk mengembangkan pertanian berkelanjutan.

-  Pengelolaan hutan yang berkelanjutan: Keterlibatan dengan pengelolaan hutan yang berkelanjutan dapat mendukung keberlanjutan sumber daya alam.

-  Pengembangan energi terbarukan: Ketersediaan savana yang luas pada elevasi tinggi, memberikan peluang untuk penembangan energi terbarukan terutama PLTB.


    ------------------------------------------------------------------------

#### Ancaman (*Threats*)

Faktor-faktor eksternal yang menghalangi pencapaian tujuan:

- Bencana alam erosi dan longsor: Cluster dengan risiko erosi dan longsor tinggi, ditambah curah hujan yang paling tinggi. Pengelolaan yang tidak baik dapat meningkatkan terjadinya bencana alam erosi dan longsong.

- Ancaman perubahan iklim: perubahan pola hujan dapat menjadi ancaman serius terhadap sektor pertanian jika pengelolaan air tidak dikelola dengan baik.

- Ketergantungan pada pertanian: Tingginya persentase pemilik lahan pertanian kecil dapat menjadi ancaman jika wilayah ini terlalu bergantung pada sektor pertanian yang mungkin rentan terhadap fluktuasi iklim.

:::



## **Tipologi 3**

::: callout-tip
Tipologi ini memiliki tingkat kemiskinan tinggi, dengan akses listrik dan sumber air yang terbatas. Keunggulannya terletak pada lahan pertanian yang luas, didukung oleh jaringan jalan yang baik. Namun infrastruktur kesehatan dan Pendidikan kurang memadai.
:::

### Karakteristik berdasarkan analisis SWOT

::: {layout-ncol="2"}
#### Kekuatan (*Strengths*)

Faktor-faktor internal yang membantu pencapaian tujuan:

- Dengan separuh luasan lahan yang dapat ditanami, kawasan ini menawarkan potensi untuk peningkatan produksi pertanian.

- Jarak rata-rata ke jalan raya yang dekat memudahkan transportasi dan distribusi produk lokal.

- Secara geografis Sebagian wilayah memiliki potensi penghidupan berbasis kelautan


    ------------------------------------------------------------------------

#### Kelemahan (*Weaknesses*)

Faktor-faktor internal yang menghalangi pencapaian tujuan:

- Tingkat kemiskinan yang tinggi menjadi tantangan dalam meningkatkan kesejahtraan dan pertumbuhan ekonomi.

- Keterbatasan fasilitas kesehatan dan pendidikan, termasuk akses listrik yang rendah, menjadi hambatan utama dalam meningkatkan kesejahtraan.

- Jarak jauh ke pelabuhan dan transportasi udara, serta keterbatasan akses ke sumber air, membatasi peluang untuk perkembangan dan pertumbuhan ekonomi berbasis pertanian.

- Risiko longsor yang tinggi.


    ------------------------------------------------------------------------

#### Peluang (*Opportunities*)

Faktor-faktor eksternal yang membantu pencapaian tujuan:

- Investasi dalam infrastruktur kesehatan, pendidikan, dan transportasi dapat meningkatkan kualitas hidup dan membuka peluang ekonomi.
- Tutupan hutan dan savanna yang luas serta area konservasi dapat menjadi daya tarik untuk pariwisata berkelanjutan.

- Praktik pertanian cerdas iklim: dataran tinggi dengan suhu sejuk, dapat dimanfatkan untuk produksi tanaman pangan dan komoditi dengan iklim kering dan sejuk.

- Dengan peningkatan suhu dan kekeringan, ada peluang untuk mengembangkan teknologi pertanian,penanaman komoditi dan varietas tanaman pangan yang lebih sesuai dengan iklim di masa mendatang.


    ------------------------------------------------------------------------

#### Ancaman (*Threats*)

Faktor-faktor eksternal yang menghalangi pencapaian tujuan:

- Perubahan iklim yang signifikan(terutama penurunan dan pergeseran curah hujan) mengancam keberlanjutan lingkungan dan kehidupan masyarakat.

- Ketergantungan pada sumber air yang jauh dan terbatas dapat menjadi masalah serius dalam pengembangan pertanian dan kehidupan sehari-hari.

- Kehilangan hutan yang signifikan dan potensi erosi tanah menimbulkan bencana, seperti banjir bandang, longsor dan kekeringan di musim kemarau
:::

## **Tipologi 4**

::: callout-tip
Tipologi ini memiliki karakter luas lahan pertanian dengan tersedianya infrastruktur irigasi. Dilain sisi juga memiliki area hutan yang luas.  Meski menghadapi tantangan seperti tingginya persentase rumah tangga kurang sejahtera dan kencenderungan gizi buruk tinggi. Curah hujan relatif rendah.  Wilayah ini memiliki aksesibilitas jalan yang baik dan akses ke badan air yang dekat.
:::

### Karakteristik berdasarkan analisis SWOT

::: {layout-ncol="2"}
#### Kekuatan (*Strengths*)

Faktor-faktor internal yang membantu pencapaian tujuan:

- Luas lahan pertanian besar dengan tersedianya area irigasi.

- Dekat dengan badan air dan memiliki jumlah embung tertinggi.

- Aksesibilitas transportasi yang baik (rata-rata jarak dari jalan raya).

- Memiliki tutupan hutan yang luas.


    ------------------------------------------------------------------------

#### Kelemahan (*Weaknesses*)

Faktor-faktor internal yang menghalangi pencapaian tujuan:

- Separuh rumah tangga belum terlayani jaringan listrik.

- Tingginya persentase rumah tangga kurang sejahtera.

- Tingkat kejadian gizi buruk tinggi.

- Jarak ke pelabuhan yang jauh.

- Curah hujan dan bulan basah relatif rendah dibandingkan tipologi lainnya.

    ------------------------------------------------------------------------

#### Peluang (*Opportunities*)

Faktor-faktor eksternal yang membantu pencapaian tujuan:

- Jaringan jalan yang tergolong baik dapat mempermudah proses pembangunan seperti:
Peningkatan layanan listrik dan fasilitas kesehatan untuk meningkatkan hidup.

- Pembangunan fasilitas pendidikan untuk meningkatkan akses dan kualitas pendidikan bagi generasi muda.

- Meningkatkan akses ke pelabuhan untuk mendukung kegiatan ekonomi dan perdagangan.

- Pengembangan irigasi dan pengelolaan sumber daya air untuk meningkatkan ketahanan terhadap kekeringan.

- Praktik pertanian cerdas iklim dapat memaksimalkan efisiensi penggunaan air dan mengurangi emisi GRK dari praktik pertanian.

- Perlindungan tutupan lahan alami untuk menjaga kelangsungan jasa lingkungan seperti penyediaan air.


    ------------------------------------------------------------------------

#### Ancaman (*Threats*)

Faktor-faktor eksternal yang menghalangi pencapaian tujuan:

- Prevalensi gizi buruk yang tinggi jika tidak ditangani segera, akan berdampak pada kualitas SDM di masa depan.

- Cuaca panas terik akan semakin sering ditemui, dan akan berpengaruh pada setiap sendi penghidupan, termasuk produksi pangan.

- Proyeksi penurunan curah hujan dan pergeseran musim hujan dapat mengganggu aktivitas pertanian.

:::

:::



**Tabel statistik deskriptif**

::: panel-tabset
## Tabel Interpretasi Tipologi

```{r TTS}
#| warning: false
#| message: false
tabel_intisari <- tar_read(summary_table_kec)|> filter(!variable         %in% c(
    "korban_kebakaran_hutan_dan_lahan_2018_2019",
    "korban_banjir_bandang_2018_2019",
    "kejadian_banjir_bandang_2018_2019",
    "korban_banjir_2018_2019",
    "korban_tanah_longsor_2018_2019",
    "kejadian_tanah_longsor_2018_2019",
    "korban_kekeringan_lahan_2018_2019",
    "kejadian_kekeringan_lahan_2018_2019",
    #"annual_temperature_c_change",
    #"precipitation_change",
   # "luas_ha",
    #"idm_2021",
    #"minimarket",
    "distance_to_forest",
    "distance_to_lake",
    #"jumlah_sistem_peringatan_dini_bencana_alam",
    #"tnp2k_rt",
    "tnp2k_indv",
    #"total_kk",
    "distance_to_irigation",
    "distance_daerah_irigasi",
    #"percentage_of_forested_area",
    #"slope",
    #"elevasi",
   # "pop_dens",
    #"distance_to_port",
    #"distance_to_coast_line",
    "ndvi_2020",
    "within_airport_coverage"
  )) |> 
  #dplyr::select(-Kepulauan) |> 
  dplyr::mutate(variable = dplyr::case_when(
    variable == "annual_mean_prec" ~ "curah hujan rata-rata tahunan",
    variable == "annual_mean_temp" ~ "suhu rata-rata tahunan",
    variable == "arable_land_percent" ~ "persentase lahan pertanian",
    variable == "aridity_index" ~ "indeks kekeringan",
    variable == "distance_to_burned_area" ~ "jarak ke area terbakar",
    variable == "distance_to_commodity_processing_factory" ~ "jarak ke pabrik pengolahan komoditas",
    variable == "distance_to_deforestation" ~ "jarak ke area deforestasi",
    variable == "distance_to_forest" ~ "jarak ke hutan",
    variable == "distance_to_plantation" ~ "jarak ke perkebunan",
    variable == "distance_to_plantation_concession" ~ "jarak ke konsesi perkebunan",
    variable == "distance_to_river" ~ "jarak ke sungai",
    variable == "distance_to_road" ~ "jarak ke jalan",
    variable == "erosion_risk_t_ha_1_yr_1" ~ "risiko erosi t ha per tahun",
    variable == "indeks_bahaya_banjir" ~ "indeks risiko banjir",
    variable == "indeks_bahaya_longsor" ~ "indeks risiko longsor",
    variable == "irrigated_land" ~ "lahan irigasi",
    variable == "percentage_deforestation_area_size" ~ "persentase ukuran area deforestasi",
    variable == "percentage_of_agricultural_area_small_holder_in_the_village" ~ "persentase area pertanian skala kecil",
    variable == "percentage_of_plantation_area_per_sub_district" ~ "persentase area perkebunan per kecamatan",
    variable == "prec_change" ~ "perubahan curah hujan",
    variable == "rasio_40pers_ekon_rendah_rt" ~ "rasio 40 persen ekonomi rendah RT",
    variable == "rasio_faskes_1" ~ "rasio fasilitas kesehatan 1",
    variable == "rasio_minimarket_swalayan" ~ "rasio minimarket swalayan",
    variable == "rasio_pt" ~ "rasio perguruan tinggi",
    variable == "rasio_rs" ~ "rasio rumah sakit",
    variable == "temp_change" ~ "perubahan suhu",
    variable == "total_kk_berdasarkan_pengguna_dan_non_pengguna_list…" ~ "total KK berdasarkan pengguna dan non pengguna listrik",
    variable == "wet_months" ~ "bulan basah",
    # Add other translations here
    TRUE ~ variable # default action to keep the original name if not matched
  )) |> 
  dplyr::mutate(variable = gsub("_", " ", variable)) |> 
  dplyr::rename(Variabel = variable)
  
tabel_intisari_formatted <- tabel_intisari |> 
  gt()|>
  tab_header(
    title = "Karakteristik Sosio-ekonomi dan Lingkungan di Berbagai Kelas Tipologi: Analisis Rata-rata dan Standar Deviasi") |> 
    opt_align_table_header(align = "left")

tabel_intisari_formatted
```

::: callout-tip
## Apa itu rata-rata dan standar deviasi?

**Rata-Rata**

Rata-rata adalah angka yang sering kita gunakan untuk mengetahui gambaran umum dari sekelompok data. Misalnya, jika rata-rata jarak ke jalan terdekat di daerah urban cuma 0,24 km, ini menunjukkan bahwa umumnya daerah tersebut dekat dengan jalan raya.

**Standar Deviasi**

Standar deviasi (SD) memberitahu kita seberapa besar variasi atau perbedaan antar angka dalam sekelompok data. Semakin tinggi SD, makin besar juga variasinya. Misalnya, rata-rata jarak ke jalan terdekat di daerah urban adalah 0,24 km dengan SD 0,45 km. Ini artinya yang sangat dekat dengan jalan, tetapi juga ada yang jauh---bahkan lebih dari dua kali lipat dari rata-rata.

Nilai standar deviasi (SD) yang besar, seperti contoh diatas, menjadi indikasi bahwa, rata-rata mungkin tidak memberikan gambaran yang mewakili suatu tipologi. Dalam hal ini, standar deviasi memberikan konteks tambahan yang penting untuk memahami sejauh mana data bervariasi.
:::

## Tabel Interpretasi tipologi (Berwarna)

Kode warna pada tabel dibawah menunjukkan rentang nilai dari variabel yang diberikan untuk masing-masing tipe wilayah. Warna biru gelap menunjukkan nilai yang lebih tinggi, sementara warna yang lebih merah terang menunjukkan nilai yang lebih rendah.

```{r color coded table}
#| warning: false
#| message: false
tar_load(summary_table_kec)
tar_load(tibble_numeric)
summary_table_kec[1] |> bind_cols(tibble_numeric) |> 
      gt(rowname_col = "variable") |> data_color(
        direction = "row",
        palette = "RdYlBu",
        na_color = "white"
      )

```

<!-- ## Tabel ranking tipologi 1 -->

<!-- ```{r ranking 1} -->
<!-- #| warning: false -->
<!-- #| message: false -->

<!-- # List all files in the 'output' folder -->
<!-- files <- list.files("output", pattern = "^Cluster 1", full.names = TRUE) -->

<!-- # Assuming there is only one file that begins with "Cluster 1" -->
<!-- file_to_read <- files[1] -->

<!-- # Read the file using read_csv -->
<!-- cluster_1_data <- read_csv(file_to_read) |> arrange(rank) -->

<!-- cluster_1_data |> gt() -->
<!-- ``` -->

<!-- ## Tabel ranking tipologi 2 -->

<!-- ```{r ranking 2} -->
<!-- #| warning: false -->
<!-- #| message: false -->

<!-- # List all files in the 'output' folder -->
<!-- files <- list.files("output", pattern = "^Cluster 2", full.names = TRUE) -->

<!-- # Assuming there is only one file that begins with "Cluster 2" -->
<!-- file_to_read <- files[1] -->

<!-- # Read the file using read_csv -->
<!-- cluster_2_data <- read_csv(file_to_read) |> arrange(rank) -->

<!-- cluster_2_data |> gt() -->
<!-- ``` -->

<!-- ## Tabel ranking tipologi 3 -->

<!-- ```{r ranking 3} -->
<!-- #| warning: false -->
<!-- #| message: false -->

<!-- # List all files in the 'output' folder -->
<!-- files <- list.files("output", pattern = "^Cluster 3", full.names = TRUE) -->

<!-- # Assuming there is only one file that begins with "Cluster 3" -->
<!-- file_to_read <- files[1] -->

<!-- # Read the file using read_csv -->
<!-- cluster_3_data <- read_csv(file_to_read) |> arrange(rank) -->

<!-- cluster_3_data |> gt() -->
<!-- ``` -->

<!-- ## Tabel ranking tipologi 4 -->

<!-- ```{r ranking 4} -->
<!-- #| warning: false -->
<!-- #| message: false -->

<!-- # List all files in the 'output' folder -->
<!-- files <- list.files("output", pattern = "^Cluster 4", full.names = TRUE) -->

<!-- # Assuming there is only one file that begins with "Cluster 4" -->
<!-- file_to_read <- files[1] -->

<!-- # Read the file using read_csv -->
<!-- cluster_4_data <- read_csv(file_to_read) |> arrange(rank) -->

<!-- cluster_4_data |> gt() -->
<!-- ``` -->

<!-- ## Tabel ranking tipologi 5 -->

<!-- ```{r ranking 5} -->
<!-- #| warning: false -->
<!-- #| message: false -->

<!-- # List all files in the 'output' folder -->
<!-- files <- list.files("output", pattern = "^Cluster 5", full.names = TRUE) -->

<!-- # Assuming there is only one file that begins with "Cluster 5" -->
<!-- file_to_read <- files[1] -->

<!-- # Read the file using read_csv -->
<!-- cluster_5_data <- read_csv(file_to_read) |> arrange(rank) -->

<!-- cluster_5_data |> gt() -->
<!-- ``` -->

<!-- ## Tabel ranking tipologi 6 -->

<!-- ```{r ranking 6} -->
<!-- #| warning: false -->
<!-- #| message: false -->

<!-- # List all files in the 'output' folder -->
<!-- files <- list.files("output", pattern = "^Cluster 6", full.names = TRUE) -->

<!-- # Assuming there is only one file that begins with "Cluster 6" -->
<!-- file_to_read <- files[1] -->

<!-- # Read the file using read_csv -->
<!-- cluster_6_data <- read_csv(file_to_read) |> arrange(rank) -->

<!-- cluster_6_data |> gt() -->
<!-- ``` -->
:::
